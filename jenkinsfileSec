pipeline {

    agent any



    environment {

        MAVEN_HOME = '/usr/share/maven'

        SONAR_HOST_URL = 'http://10.0.2.15:9000'

        SONAR_PROJECT_KEY = 'foyer'



    }



    stages {

        stage('Checkout') {

            steps {

                git branch: 'wissal', url: 'https://github.com/dhaouzeineb/tp-foyer.git'

            }

        }



        stage('Pre-Commit') {

            steps {

                script {

                    sh "pre-commit run --all-files || true"

                    sh "git add ."

                }

            }

        }



        stage('Commit') {

            steps {

                withCredentials([string(credentialsId: 'sonar', variable: 'SONAR_TOKEN')]) {

                    script {

                        sh "${MAVEN_HOME}/bin/mvn sonar:sonar -Dsonar.projectKey=${SONAR_PROJECT_KEY} -Dsonar.host.url=${SONAR_HOST_URL} -Dsonar.login=${SONAR_TOKEN}"

                    }

                }

            }

        }



        stage('Acceptance') {

                    steps {

                        dependencyCheck additionalArguments: '--format HTML', odcInstallation: 'DP -Chek'

                    }

                }

    }

    post {

        always {

            echo 'Pipeline completed.'

        }

    }

}
