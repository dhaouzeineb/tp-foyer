pipeline {
    agent any

    environment {
        NEXUS_URL = 'http://192.168.33.10:8081/nexus' // Remplacez avec l'URL de votre Nexus
        NEXUS_REPO = 'nexus-jenkins' // Nom de votre dépôt Nexus
        CREDENTIALS_ID = 'nexus-credentials' // ID des credentials Jenkins pour Nexus
    }

    stages {
        stage('Build') {
            steps {
                script {
                    // Compile et package le projet avec Maven
                    sh 'mvn clean install'
                }
            }
        }

        stage('Upload to Nexus') {
            steps {
                withCredentials([usernamePassword(credentialsId: "${CREDENTIALS_ID}", usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                    script {
                        // Déploiement sur Nexus en utilisant la commande Maven
                        try {
                            sh """
                            mvn deploy:deploy-file -Durl=${NEXUS_URL}/repository/${NEXUS_REPO}
                                                    -DrepositoryId=${NEXUS_REPO}
                                                    -Dfile=target/nomDuFichier.jar
                                                    -DgroupId=com.example
                                                    -DartifactId=nomDuProjet
                                                    -Dversion=1.0.0
                                                    -Dpackaging=jar
                                                    -DgeneratePom=true
                                                    -Dusername=${USERNAME}
                                                    -Dpassword=${PASSWORD}
                            """
                        } catch (Exception e) {
                            error "Échec du déploiement : ${e.getMessage()}"
                        }
                    }
                }
            }
        }
    }

    post {
        success {
            echo 'Déploiement réussi sur Nexus'
        }
        failure {
            echo 'Échec du déploiement sur Nexus'
        }
    }
}


